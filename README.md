# æ–‡ä»¶é˜…è¯»ç³»ç»Ÿ (File Reading System)

ä¸€ä¸ªæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼è¯»å–ã€è§£æå’Œæ ¼å¼åŒ–è¾“å‡ºçš„é€šç”¨æ–‡ä»¶å¤„ç†ç³»ç»Ÿã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚è¾“å‡ºä¸åŒæ ¼å¼çš„æ•°æ®ï¼ˆå¦‚ Markdownã€DataFrameã€åˆ†å—æ•°æ®ç­‰ï¼‰ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ğŸ“ ç›®å½•ç»“æ„è¯´æ˜

```
file_read_system/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ file_upload.py
â”‚   â”‚   â”‚   â”œâ”€â”€ health.py
â”‚   â”‚   â”‚   â””â”€â”€ task_management.py
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚       â”œâ”€â”€ upload.py
â”‚   â”‚       â””â”€â”€ file_process_schemas.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ exceptions.py
â”‚   â”‚   â”œâ”€â”€ file_manager.py
â”‚   â”‚   â”œâ”€â”€ job_manager.py
â”‚   â”‚   â””â”€â”€ task_manager.py
â”‚   â”œâ”€â”€ ocr/
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”œâ”€â”€ parsers/
â”‚   â”‚   â””â”€â”€ converters/
â”‚   â”‚       â”œâ”€â”€ file_convert.py
â”‚   â”‚       â””â”€â”€ markdown_convert.py
â”‚   â”œâ”€â”€ processors/
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ file_utils.py
â”‚   â””â”€â”€ vectorization/
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ logging_config.py
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ docs/
â”œâ”€â”€ logs/
â”œâ”€â”€ static/
â”œâ”€â”€ templates/
â”œâ”€â”€ uploads/
â”œâ”€â”€ temp/
â”œâ”€â”€ main.py
â”œâ”€â”€ run.py
â””â”€â”€ requirements.txt
```

## ğŸ”§ å„æ¨¡å—è¯¦ç»†è¯´æ˜

### ğŸ“Š API å±‚ (`app/api/`)

- **routes/**: å®šä¹‰ RESTful API è·¯ç”±ï¼ŒåŒ…æ‹¬æ–‡ä»¶ä¸Šä¼ ã€å¤„ç†çŠ¶æ€æŸ¥è¯¢ã€ç»“æœä¸‹è½½ç­‰æ¥å£
- **middleware/**: è¯·æ±‚ä¸­é—´ä»¶ï¼Œå¤„ç†è®¤è¯ã€é™æµã€CORS ç­‰
- **schemas/**: ä½¿ç”¨ Pydantic å®šä¹‰è¯·æ±‚/å“åº”æ•°æ®æ¨¡å‹

### ğŸ§  æ ¸å¿ƒä¸šåŠ¡å±‚ (`app/core/`)

- **file_manager.py**: ç®¡ç†æ–‡ä»¶çš„ä¸Šä¼ ã€å­˜å‚¨ã€åˆ é™¤ç­‰æ“ä½œ
- **task_queue.py**: å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¤„ç†å¤§æ–‡ä»¶çš„åå°è§£æä»»åŠ¡
- **exceptions.py**: å®šä¹‰ç³»ç»Ÿè‡ªå®šä¹‰å¼‚å¸¸ç±»

### ğŸ” è§£æå™¨å±‚ (`app/parsers/`)

**èŒè´£**: å°†ä¸åŒæ ¼å¼çš„æ–‡ä»¶è½¬æ¢ä¸ºç»Ÿä¸€çš„å†…éƒ¨æ•°æ®ç»“æ„

- **base_parser.py**: è§£æå™¨æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
- **text_parser.py**: å¤„ç†çº¯æ–‡æœ¬ã€Markdownã€CSV ç­‰æ–‡æœ¬æ ¼å¼
- **office_parser.py**: è§£æ Wordã€Excelã€PowerPoint æ–‡æ¡£
- **pdf_parser.py**: æå– PDF æ–‡æ¡£çš„æ–‡æœ¬å’Œå…ƒæ•°æ®
- **image_parser.py**: è°ƒç”¨OCRæ¨¡å—å¤„ç†å›¾åƒæ–‡ä»¶ï¼Œæå–æ–‡æœ¬å†…å®¹
- **code_parser.py**: è§£æå„ç§ç¼–ç¨‹è¯­è¨€æºä»£ç æ–‡ä»¶
- **binary_parser.py**: å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶çš„å…ƒæ•°æ®æå–

### ğŸ‘ï¸ OCRæ¨¡å— (`app/ocr/`)

**èŒè´£**: ä¸“é—¨å¤„ç†å›¾åƒä¸­çš„æ–‡å­—è¯†åˆ«ï¼Œæ”¯æŒå¤šç§OCRå¼•æ“

- **base_ocr.py**: OCRå¼•æ“æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€çš„OCRæ¥å£

### âš™ï¸ å¤„ç†å™¨å±‚ (`app/processors/`)

**èŒè´£**: å¯¹è§£æåçš„æ•°æ®è¿›è¡ŒäºŒæ¬¡å¤„ç†å’Œä¼˜åŒ–

- **chunker.py**: åŸºç¡€æ–‡æœ¬åˆ†å—ï¼Œæ”¯æŒæŒ‰æ®µè½ã€å¥å­ã€å­—ç¬¦æ•°ç­‰æ–¹å¼åˆ‡åˆ†
- **analyzer.py**: å†…å®¹åˆ†æï¼Œæå–å…³é”®è¯ã€æ‘˜è¦ã€ç»Ÿè®¡ä¿¡æ¯ç­‰
- **cleaner.py**: æ•°æ®æ¸…æ´—ï¼Œå»é™¤å™ªå£°ã€æ ¼å¼åŒ–æ–‡æœ¬ç­‰
- **transformer.py**: æ•°æ®æ ¼å¼è½¬æ¢å’Œç»“æ„åŒ–å¤„ç†

### ğŸ§® å‘é‡åŒ–æ¨¡å— (`app/vectorization/`)

**èŒè´£**: ä¸“é—¨å¤„ç†é¢å‘å‘é‡åŒ–çš„æ–‡æœ¬åˆ‡å—å’Œé¢„å¤„ç†ï¼ˆä¸åŒ…å«å®é™…å‘é‡åŒ–ï¼‰

- **semantic_chunker.py**: è¯­ä¹‰æ„ŸçŸ¥çš„æ™ºèƒ½åˆ†å—å™¨ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§
- **chunk_optimizer.py**: åˆ†å—ä¼˜åŒ–å™¨ï¼Œè°ƒæ•´åˆ†å—å¤§å°å’Œé‡å åº¦
- **embedding_prep.py**: å‘é‡åŒ–é¢„å¤„ç†ï¼Œä¸ºåç»­embeddingåšå‡†å¤‡
- **chunk_strategies.py**: å¤šç§åˆ†å—ç­–ç•¥ï¼ˆå›ºå®šé•¿åº¦ã€æ»‘åŠ¨çª—å£ã€è¯­ä¹‰è¾¹ç•Œç­‰ï¼‰
- **chunk_evaluator.py**: åˆ†å—è´¨é‡è¯„ä¼°å™¨ï¼Œè¯„ä¼°åˆ†å—æ•ˆæœ

### ğŸ“¤ è¾“å‡ºå±‚ (`app/outputs/`)

**èŒè´£**: å°†å¤„ç†åçš„æ•°æ®è½¬æ¢ä¸ºç”¨æˆ·éœ€è¦çš„è¾“å‡ºæ ¼å¼

- **markdown_output.py**: ç”Ÿæˆæ ¼å¼åŒ–çš„ Markdown æ–‡æ¡£
- **dataframe_output.py**: è¾“å‡º Pandas DataFrame æˆ– CSV æ ¼å¼
- **json_output.py**: ç”Ÿæˆç»“æ„åŒ–çš„ JSON æ•°æ®
- **excel_output.py**: åˆ›å»º Excel å·¥ä½œç°¿
- **custom_output.py**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼

### ğŸ› ï¸ å·¥å…·å±‚ (`app/utils/`)

- **file_utils.py**: æ–‡ä»¶æ“ä½œã€æ ¼å¼æ£€æµ‹ã€å¤§å°éªŒè¯ç­‰
- **validation.py**: è¾“å…¥å‚æ•°éªŒè¯å’Œæ•°æ®æ ¡éªŒ
- **logging.py**: ç»“æ„åŒ–æ—¥å¿—è®°å½•
- **helpers.py**: é€šç”¨è¾…åŠ©å‡½æ•°

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### ğŸ“ æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

- **æ–‡æœ¬æ–‡ä»¶**: .txt, .md, .csv, .tsv
- **Office æ–‡æ¡£**: .docx, .xlsx, .pptx
- **PDF æ–‡æ¡£**: .pdf
- **å›¾åƒæ–‡ä»¶**: .jpg, .png, .tiff (OCR)
- **ä»£ç æ–‡ä»¶**: .py, .js, .java, .cpp, .html ç­‰
- **å…¶ä»–æ ¼å¼**: å¯æ‰©å±•æ”¯æŒ

### ğŸ“‹ è¾“å‡ºæ ¼å¼é€‰é¡¹

- **Markdown**: æ ¼å¼åŒ–æ–‡æ¡£ï¼Œæ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ã€ä»£ç å—
- **DataFrame**: Pandas DataFrame æˆ– CSV æ ¼å¼
- **JSON**: ç»“æ„åŒ–æ•°æ®è¾“å‡º
- **Excel**: å¤šå·¥ä½œè¡¨ Excel æ–‡ä»¶
- **åˆ†å—è¾“å‡º**: æŒ‰æŒ‡å®šè§„åˆ™åˆ‡åˆ†çš„æ–‡æœ¬å—
- **è‡ªå®šä¹‰æ ¼å¼**: æ ¹æ®ç”¨æˆ·éœ€æ±‚å®šåˆ¶

### ğŸ”§ å¤„ç†åŠŸèƒ½

- **æ™ºèƒ½åˆ†å—**: æŒ‰è¯­ä¹‰ã€æ®µè½æˆ–å›ºå®šé•¿åº¦åˆ†å‰²
- **å†…å®¹åˆ†æ**: å…³é”®è¯æå–ã€æ‘˜è¦ç”Ÿæˆ
- **æ•°æ®æ¸…æ´—**: å»é™¤æ ¼å¼å™ªå£°ã€æ ‡å‡†åŒ–æ–‡æœ¬
- **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šæ–‡ä»¶å¹¶å‘å¤„ç†
- **è¿›åº¦è·Ÿè¸ª**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦

## ğŸ’» æŠ€æœ¯æ ˆå»ºè®®

### åç«¯æ¡†æ¶

- **FastAPI**: ç°ä»£ã€é«˜æ€§èƒ½çš„ Python Web æ¡†æ¶
- **Celery**: åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **Redis**: ç¼“å­˜å’Œä»»åŠ¡é˜Ÿåˆ—å­˜å‚¨

### æ–‡ä»¶å¤„ç†åº“

- **pandas**: æ•°æ®å¤„ç†å’Œ DataFrame æ“ä½œ
- **openpyxl**: Excel æ–‡ä»¶è¯»å†™
- **python-docx**: Word æ–‡æ¡£å¤„ç†
- **PyPDF2/pdfplumber**: PDF æ–‡æ¡£è§£æ
- **chardet**: å­—ç¬¦ç¼–ç æ£€æµ‹

### OCR ç›¸å…³åº“

- **pytesseract**: Tesseract OCR Python å°è£…
- **PaddleOCR**: ç™¾åº¦å¼€æºçš„é«˜ç²¾åº¦OCRå·¥å…·
- **Pillow (PIL)**: å›¾åƒå¤„ç†å’Œé¢„å¤„ç†
- **opencv-python**: å›¾åƒé¢„å¤„ç†å’Œå¢å¼º
- **easyocr**: ç®€å•æ˜“ç”¨çš„OCRåº“
- **äº‘ç«¯OCR SDK**: ç™¾åº¦ã€è…¾è®¯ã€é˜¿é‡Œäº‘ã€Azureç­‰

### å‘é‡åŒ–åˆ‡å—ç›¸å…³åº“

- **spacy**: è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œè¯­ä¹‰åˆ†æ
- **nltk**: è‡ªç„¶è¯­è¨€å·¥å…·åŒ…ï¼Œå¥å­åˆ†å‰²
- **langchain**: æ–‡æœ¬åˆ†å—å’Œå‘é‡åŒ–å·¥å…·é“¾
- **tiktoken**: OpenAIçš„tokenizerï¼Œç²¾ç¡®è®¡ç®—tokenæ•°
- **sentence-transformers**: è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆç”¨äºåˆ†å—è´¨é‡è¯„ä¼°ï¼‰

### æ•°æ®åº“

- **SQLite/PostgreSQL**: å…ƒæ•°æ®å­˜å‚¨
- **MinIO/S3**: æ–‡ä»¶å¯¹è±¡å­˜å‚¨

### å‰ç«¯ (å¯é€‰)

- **Vue.js/React**: ç”¨æˆ·ç•Œé¢
- **Element Plus/Ant Design**: UI ç»„ä»¶åº“

## ğŸ”„ å·¥ä½œæµç¨‹

### æ ‡å‡†å¤„ç†æµç¨‹

1. **æ–‡ä»¶ä¸Šä¼ ** â†’ éªŒè¯æ ¼å¼å’Œå¤§å°
2. **æ ¼å¼è¯†åˆ«** â†’ é€‰æ‹©åˆé€‚çš„è§£æå™¨
3. **å†…å®¹è§£æ** â†’ æå–æ–‡æœ¬å’Œç»“æ„åŒ–æ•°æ®
4. **æ•°æ®å¤„ç†** â†’ æ¸…æ´—ã€åˆ†æã€è½¬æ¢
5. **æ ¼å¼è¾“å‡º** â†’ ç”Ÿæˆç”¨æˆ·éœ€è¦çš„æ ¼å¼
6. **ç»“æœè¿”å›** â†’ ä¸‹è½½æˆ–åœ¨çº¿é¢„è§ˆ

### OCR å¤„ç†æµç¨‹

1. **å›¾åƒä¸Šä¼ ** â†’ æ ¼å¼éªŒè¯ï¼ˆjpg, png, tiffç­‰ï¼‰
2. **å›¾åƒé¢„å¤„ç†** â†’ å»å™ªã€å¢å¼ºã€æ ¡æ­£ï¼ˆ`ocr/preprocessor.py`ï¼‰
3. **OCRå¼•æ“é€‰æ‹©** â†’ æ ¹æ®è¯­è¨€å’Œç²¾åº¦è¦æ±‚é€‰æ‹©å¼•æ“
4. **æ–‡å­—è¯†åˆ«** â†’ æå–æ–‡æœ¬å†…å®¹å’Œåæ ‡ä¿¡æ¯
5. **ç»“æœåå¤„ç†** â†’ ç½®ä¿¡åº¦è¿‡æ»¤ã€æ–‡æœ¬çŸ«æ­£ï¼ˆ`ocr/postprocessor.py`ï¼‰
6. **æ–‡æœ¬è¾“å‡º** â†’ è¿”å›ç»“æ„åŒ–æ–‡æœ¬æ•°æ®

### å‘é‡åŒ–åˆ‡å—æµç¨‹

1. **æ–‡æœ¬è¾“å…¥** â†’ å·²è§£æçš„çº¯æ–‡æœ¬å†…å®¹
2. **åˆ†å—ç­–ç•¥é€‰æ‹©** â†’ å›ºå®šé•¿åº¦/è¯­ä¹‰è¾¹ç•Œ/æ»‘åŠ¨çª—å£ç­‰
3. **è¯­ä¹‰åˆ†æ** â†’ è¯†åˆ«æ®µè½ã€å¥å­è¾¹ç•Œï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§
4. **æ™ºèƒ½åˆ‡å—** â†’ æ ¹æ®tokené™åˆ¶å’Œé‡å åº¦è¿›è¡Œåˆ†å—
5. **è´¨é‡è¯„ä¼°** â†’ è¯„ä¼°åˆ†å—æ•ˆæœå’Œè¯­ä¹‰è¿è´¯æ€§
6. **åˆ‡å—è¾“å‡º** â†’ è¿”å›é€‚åˆå‘é‡åŒ–çš„æ–‡æœ¬å—æ•°ç»„

## âš¡ API å¿«é€Ÿç”¨æ³•ï¼ˆå¯¹é½å½“å‰å®ç°ï¼‰

- æ¥å£ï¼š`POST /api/v1/file/process`
- ç›®æ ‡æ ¼å¼ï¼ˆtarget_formatï¼‰ï¼š`plain_text | markdown | dataframe`
- ç»“æœï¼š`result_data` å†…å§‹ç»ˆæŒ‰ç›®æ ‡æ ¼å¼è¿”å›ä¸»ä½“æ•°æ®ï¼Œå¹¶åœ¨å¯ç”¨æ—¶é™„å¸¦ `chunking` ä¸ `summary`

ç¤ºä¾‹ï¼šè¯­ä¹‰åˆ‡åˆ† + æ‘˜è¦ + æ–‡æœ¬è¿”å›

```json
{
  "task_id": "task_xxx",
  "purpose": "content_reading",
  "target_format": "plain_text",
  "table_precision": 10,
  "enable_chunking": true,
  "chunking_strategy": "semantic_splitting",
  "chunk_size": 800,
  "chunk_overlap": 120,
  "chunking_config": {
    "semantic_splitting_config": {
      "similarity_threshold": 0.3
    }
  },
  "enable_multi_file_summary": true,
  "summary_length": 300,
  "summary_focus": ["main_points", "key_findings"],
  "summary_return_top_k": 5
}
```

è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†å—ï¼ˆLevel 6ï¼‰

```json
{
  "task_id": "task_xxx",
  "purpose": "content_reading",
  "target_format": "plain_text",
  "enable_chunking": true,
  "chunking_strategy": "custom_delimiter_splitting",
  "chunk_size": 800,
  "chunk_overlap": 120,
  "chunking_config": {
    "custom_delimiter_config": {"delimiter": "â€”â€”ENDâ€”â€”"}
  }
}
```

è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†å—å¹¶ä¿æŒè¡¨æ ¼å®Œæ•´ï¼ˆLevel 6+ï¼‰

```json
{
  "task_id": "task_xxx",
  "purpose": "content_reading",
  "target_format": "markdown",
  "enable_chunking": true,
  "chunking_strategy": "custom_delimiter_splitting_with_chunk_size_and_leave_table_alone",
  "chunk_size": 1000,
  "chunk_overlap": 100,
  "chunking_config": {
    "custom_delimiter_config": {"delimiter": "\n\n"}
  }
}
```

è¯´æ˜ä¸çº¦æŸ

- DataFrame ä»…è¿”å› `records`ï¼ˆlist[dict]ï¼‰æˆ– `records_list`ï¼ˆå¤šæ–‡ä»¶ï¼‰ã€‚
- è‹¥æŠ½å–å†…å®¹ä¸ºç©ºï¼ˆå¦‚ PDF æ— æ–‡æœ¬å±‚ï¼‰ï¼Œæ‘˜è¦å°†çŸ­è·¯ä¸ºç©ºï¼Œä¸è°ƒç”¨æ¨¡å‹ã€‚
- åˆ‡å—ç»“æœåŒ…å«ï¼š
  - `chunking.chunks`ï¼šåˆå¹¶æ–‡æœ¬åçš„æ•´ä½“åˆ‡ç‰‡
  - `chunking.per_file[i].chunks`ï¼šé€æ–‡ä»¶åˆ‡ç‰‡ï¼ˆç”¨äºæ¥æºå®šä½ï¼‰

æ›´å¤šç¤ºä¾‹è§ `docs/requests/`ã€‚

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

- æ–‡ä»¶ç±»å‹ç™½åå•éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ¶æ„æ–‡ä»¶æ‰«æ
- ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†
- è®¿é—®æƒé™æ§åˆ¶

è¿™ä¸ªæ¶æ„è®¾è®¡å…·æœ‰é«˜åº¦çš„æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ–‡ä»¶æ ¼å¼æ”¯æŒå’Œè¾“å‡ºæ ¼å¼ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ™°å’Œç»´æŠ¤æ€§ã€‚
